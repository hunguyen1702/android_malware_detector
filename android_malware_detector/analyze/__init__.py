import numpy as np
from android_malware_detector.preprocess.extractor import APKExtractor
from android_malware_detector.preprocess.transform.factory import VectorTransformFactory
from android_malware_detector.model.factory import ModelFactory


def APKAnalyze(fp, model_name, tmp_dir='./', verbose=True):
    raw_data = APKExtractor.extract(fp, tmp_dir)
    feature_vector = VectorTransformFactory.get_transform_result(raw_data, model_name)
    malware_rate = ModelFactory.get_predict_result(feature_vector, model_name)
    if verbose:
        if np.round(malware_rate) == 1:
            print "[INFO][ANALYZE RESULT] This file has %0.2f%% to be a malware" % (malware_rate * 100)
        else:
            print "[INFO][ANALYZE RESULT] This file is not a malware (result: %0.2f%%)" % (malware_rate * 100)
    return malware_rate
